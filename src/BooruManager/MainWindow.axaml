<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
        xmlns:converters="clr-namespace:BooruManager.Converters"
        x:Class="BooruManager.MainWindow"
        Title="Advanced Booru Manager by Elia1995"
        Width="2000"
        MinWidth="1450"
        Height="820"
        Background="#11161D">
  <Window.Resources>
    <converters:BoolToDoubleConverter x:Key="BoolToDoubleConverter"/>
    <DataTemplate x:Key="PostCardTemplate">
      <Border Classes="postCard"
              Margin="12"
              Width="340"
              Height="400"
              Background="#0D1730"
              CornerRadius="14"
              DoubleTapped="PostCard_OnDoubleTapped"
              Opacity="{Binding IsLoaded, Converter={StaticResource BoolToDoubleConverter}, ConverterParameter=1:0}">
        <Border.ContextMenu>
          <ContextMenu Opened="PostContextMenu_OnOpened">
            <MenuItem Header="Visualizza" CommandParameter="{Binding}" Click="ContextView_OnClick"/>
            <MenuItem Header="Aggiungi ai preferiti" CommandParameter="{Binding}" Click="ContextToggleFavorite_OnClick"/>
            <MenuItem Header="Visualizza tag" CommandParameter="{Binding}" Click="ContextViewTags_OnClick"/>
            <Separator/>
            <MenuItem Header="Copia URL post" CommandParameter="{Binding}" Click="ContextCopyPostUrl_OnClick"/>
            <MenuItem Header="Copia URL media" CommandParameter="{Binding}" Click="ContextCopyMediaUrl_OnClick"/>
            <MenuItem Header="Copia tag" CommandParameter="{Binding}" Click="ContextCopyTags_OnClick"/>
          </ContextMenu>
        </Border.ContextMenu>
        <Grid RowDefinitions="215,Auto,*" Margin="10">
          <Border Grid.Row="0" Background="#0A0B11" CornerRadius="10">
            <Grid>
              <Image Source="{Binding PreviewImage}" Stretch="Uniform"/>
              <Button HorizontalAlignment="Left"
                      VerticalAlignment="Top"
                      Margin="6"
                      Width="28"
                      Height="26"
                      Padding="0"
                      Background="#99000000"
                      Click="OpenPostButton_OnClick">
                <materialIcons:MaterialIcon Kind="OpenInNew"
                                            Width="15"
                                            Height="15"
                                            Foreground="#DCE8F8"/>
              </Button>
              <Button HorizontalAlignment="Right"
                      VerticalAlignment="Top"
                      Margin="6"
                      Width="28"
                      Height="26"
                      Padding="0"
                      Background="#99000000"
                      Click="FavoriteButton_OnClick">
                <materialIcons:MaterialIcon Kind="{Binding FavoriteIconKind}"
                                            Width="18"
                                            Height="18"
                                            Foreground="#FF5D78"/>
              </Button>
            </Grid>
          </Border>

          <TextBlock Grid.Row="1"
                     Margin="2,10,2,0"
                     Text="{Binding SummaryLine}"
                     FontSize="12"
                     FontWeight="SemiBold"
                     Foreground="#59BEF9"
                     TextWrapping="Wrap"
                     MaxLines="3"/>

          <Border Grid.Row="2" Margin="0,8,0,0">
            <TextBlock Text="{Binding TagsDisplay}"
                       FontSize="16"
                       Foreground="#D7E6FA"
                       TextWrapping="Wrap"
                       MaxLines="2"
                       TextTrimming="CharacterEllipsis"/>
          </Border>
        </Grid>
      </Border>
    </DataTemplate>
  </Window.Resources>

  <Window.Styles>
    <Style Selector="Border.postCard">
      <Setter Property="Opacity" Value="0"/>
      <Setter Property="Transitions">
        <Transitions>
          <DoubleTransition Property="Opacity" Duration="0:0:0.3"/>
        </Transitions>
      </Setter>
      <Setter Property="BorderThickness" Value="1.5"/>
      <Setter Property="BorderBrush" Value="#2A8FD7"/>
    </Style>

    <Style Selector="Border.postCard:pointerover">
      <Setter Property="Opacity" Value="0.9"/>
    </Style>
  </Window.Styles>

  <Grid ColumnDefinitions="300,*" Margin="12">
    <Border Grid.Column="0" Background="#1A2330" CornerRadius="10" Padding="14">
      <ScrollViewer VerticalScrollBarVisibility="Hidden"
                    HorizontalScrollBarVisibility="Disabled">
      <StackPanel Spacing="10" Margin="0,0,4,0">
        <TextBlock Text="Sources" FontSize="18" FontWeight="SemiBold"/>

        <TextBlock Text="Booru"/>
        <ComboBox ItemsSource="{Binding Sites}" SelectedItem="{Binding SelectedSite}"/>

        <TextBlock Text="Tags" Margin="0,6,0,0"/>
        <TextBox Watermark="e.g. blue_eyes solo" Text="{Binding SearchText}" KeyDown="SearchTextBox_OnKeyDown"/>

        <TextBlock Text="Recent searches" Margin="0,6,0,0"/>
        <ComboBox ItemsSource="{Binding RecentSearches}" SelectedItem="{Binding SelectedRecentSearch}"/>
        <Button Content="Clear history" Command="{Binding ClearHistoryCommand}"/>

        <TextBlock Text="Results per page" Margin="0,6,0,0"/>
        <ComboBox ItemsSource="{Binding PageSizeOptions}" SelectedItem="{Binding SelectedPageSize}"/>

        <TextBlock Text="Sort" Margin="0,6,0,0"/>
        <ComboBox ItemsSource="{Binding SortOptions}" SelectedItem="{Binding SelectedSortOption}"/>

        <TextBlock Text="Media type filter" Margin="0,6,0,0"/>
        <ComboBox ItemsSource="{Binding MediaTypeFilterOptions}" SelectedItem="{Binding SelectedMediaTypeFilter}"/>

        <TextBlock Text="Size filter" Margin="0,6,0,0"/>
        <ComboBox ItemsSource="{Binding SizeFilterOptions}" SelectedItem="{Binding SelectedSizeFilter}"/>

        <TextBlock Text="Rating filter" Margin="0,6,0,0"/>
        <StackPanel Orientation="Horizontal" Spacing="8">
          <CheckBox Content="safe" IsChecked="{Binding IncludeSafe}"/>
          <CheckBox Content="questionable" IsChecked="{Binding IncludeQuestionable}"/>
          <CheckBox Content="adult" IsChecked="{Binding IncludeAdult}"/>
        </StackPanel>
        <CheckBox Content="{Binding FavoritesSummary}" IsChecked="{Binding ShowFavoritesOnly}"/>

        <TextBlock Text="Local filters" Margin="0,8,0,0" FontWeight="SemiBold"/>
        <TextBlock Text="Minimum score"/>
        <ComboBox ItemsSource="{Binding MinimumScoreOptions}" SelectedItem="{Binding MinimumScore}"/>

        <TextBlock Text="Minimum width"/>
        <ComboBox ItemsSource="{Binding MinimumDimensionOptions}" SelectedItem="{Binding MinimumWidth}"/>

        <TextBlock Text="Minimum height"/>
        <ComboBox ItemsSource="{Binding MinimumDimensionOptions}" SelectedItem="{Binding MinimumHeight}"/>

        <TextBlock Text="Must include tags" Margin="0,6,0,0"/>
        <TextBox Watermark="tag_a tag_b" Text="{Binding RequiredTags}"/>

        <TextBlock Text="Exclude tags"/>
        <TextBox Watermark="tag_x tag_y" Text="{Binding ExcludedTags}"/>

        <Button Content="Reset local filters" Command="{Binding ResetLocalFiltersCommand}"/>
        <Button Content="Shuffle visible results" Command="{Binding ShuffleVisibleCommand}"/>
        <Button Content="Export visible CSV" Command="{Binding ExportVisibleCommand}"/>
        <Button Content="Check for updates" Click="CheckUpdatesButton_OnClick"/>

        <Separator Margin="0,6,0,6"/>

        <TextBlock Text="Login" FontSize="16" FontWeight="SemiBold"/>
        <TextBlock Text="{Binding LoggedInAsText}" IsVisible="{Binding ShowLoggedInInfo}"/>

        <StackPanel Spacing="6" IsVisible="{Binding ShowCredentialInputs}">
          <TextBlock Text="Username"/>
          <TextBox Text="{Binding Username}"/>

          <TextBlock Text="{Binding SecretLabel}"/>
          <TextBox Text="{Binding Secret}" PasswordChar="*"/>
        </StackPanel>

        <Button Content="{Binding LoginButtonText}" Command="{Binding LoginToggleCommand}" Margin="0,4,0,0"/>

        <Separator Margin="0,8,0,0"/>
        <Button Content="Search" Command="{Binding SearchCommand}" Height="34"/>
      </StackPanel>
      </ScrollViewer>
    </Border>

    <Grid Grid.Column="1" RowDefinitions="*,Auto" Margin="12,0,0,0">
      <Border Grid.Row="0" Background="#0F141B" CornerRadius="10" Padding="10">
        <TabControl>
          <TabItem Header="Browse">
            <ScrollViewer x:Name="PostsScrollViewer" ScrollChanged="PostsScrollViewer_OnScrollChanged">
              <ItemsControl ItemsSource="{Binding Images}" ItemTemplate="{StaticResource PostCardTemplate}">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal" ItemWidth="368" ItemHeight="424"/>
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
              </ItemsControl>
            </ScrollViewer>
          </TabItem>

          <TabItem Header="{Binding FavoritesTabTitle}">
            <ScrollViewer>
              <ItemsControl ItemsSource="{Binding FavoriteImages}" ItemTemplate="{StaticResource PostCardTemplate}">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal" ItemWidth="368" ItemHeight="424"/>
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
              </ItemsControl>
            </ScrollViewer>
          </TabItem>
        </TabControl>
      </Border>

      <Border Grid.Row="1" Margin="0,10,0,0" Background="#1A2330" CornerRadius="8" Padding="10,6">
        <TextBlock Text="{Binding StatusText}"/>
      </Border>
    </Grid>
  </Grid>
</Window>
