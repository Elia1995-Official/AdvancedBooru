<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialIcons="clr-namespace:Material.Icons.Avalonia;assembly=Material.Icons.Avalonia"
        xmlns:converters="clr-namespace:BooruManager.Converters"
        x:Class="BooruManager.MainWindow"
        Title="Advanced Booru Manager by Elia1995"
        Width="2000"
        MinWidth="1450"
        Height="820"
        Background="#11161D">
  <Window.Resources>
    <converters:BoolToDoubleConverter x:Key="BoolToDoubleConverter"/>
    <DataTemplate x:Key="PostCardTemplate">
      <Border Classes.postCard="{Binding IsSelected}"
              Margin="12"
              Width="340"
              Height="400"
              Background="#0D1730"
              CornerRadius="14"
              DoubleTapped="PostCard_OnDoubleTapped"
              Tapped="PostCard_OnTapped"
              Opacity="{Binding IsLoaded, Converter={StaticResource BoolToDoubleConverter}, ConverterParameter=1:0}">
        <Border.ContextMenu>
          <ContextMenu Opened="PostContextMenu_OnOpened">
            <MenuItem Header="Visualizza" CommandParameter="{Binding}" Click="ContextView_OnClick"/>
            <MenuItem Header="Aggiungi ai preferiti" CommandParameter="{Binding}" Click="ContextToggleFavorite_OnClick"/>
            <MenuItem Header="Visualizza tag" CommandParameter="{Binding}" Click="ContextViewTags_OnClick"/>
            <Separator/>
            <MenuItem Header="Copia URL post" CommandParameter="{Binding}" Click="ContextCopyPostUrl_OnClick"/>
            <MenuItem Header="Copia URL media" CommandParameter="{Binding}" Click="ContextCopyMediaUrl_OnClick"/>
            <MenuItem Header="Copia tag" CommandParameter="{Binding}" Click="ContextCopyTags_OnClick"/>
          </ContextMenu>
        </Border.ContextMenu>
        <Grid RowDefinitions="215,Auto,*" Margin="10">
          <Border Grid.Row="0" Background="#0A0B11" CornerRadius="10">
            <Grid>
              <Image Source="{Binding PreviewImage}" Stretch="Uniform"/>
              <Button HorizontalAlignment="Left"
                      VerticalAlignment="Top"
                      Margin="6"
                      Width="28"
                      Height="26"
                      Padding="0"
                      Background="#99000000"
                      Click="OpenPostButton_OnClick">
                <materialIcons:MaterialIcon Kind="OpenInNew"
                                            Width="15"
                                            Height="15"
                                            Foreground="#DCE8F8"/>
              </Button>
              <Button HorizontalAlignment="Right"
                      VerticalAlignment="Top"
                      Margin="6"
                      Width="28"
                      Height="26"
                      Padding="0"
                      Background="#99000000"
                      Click="FavoriteButton_OnClick">
                <materialIcons:MaterialIcon Kind="{Binding FavoriteIconKind}"
                                            Width="18"
                                            Height="18"
                                            Foreground="#FF5D78"/>
              </Button>
            </Grid>
          </Border>

          <TextBlock Grid.Row="1"
                     Margin="2,10,2,0"
                     Text="{Binding SummaryLine}"
                     FontSize="12"
                     FontWeight="SemiBold"
                     Foreground="#59BEF9"
                     TextWrapping="Wrap"
                     MaxLines="3"/>

          <Border Grid.Row="2" Margin="0,8,0,0">
            <TextBlock Text="{Binding TagsDisplay}"
                       FontSize="16"
                       Foreground="#D7E6FA"
                       TextWrapping="Wrap"
                       MaxLines="2"
                       TextTrimming="CharacterEllipsis"/>
          </Border>
        </Grid>
      </Border>
    </DataTemplate>
  </Window.Resources>

  <Window.Styles>
    <Style Selector="Border.postCard">
      <Setter Property="Opacity" Value="0"/>
      <Setter Property="Transitions">
        <Transitions>
          <DoubleTransition Property="Opacity" Duration="0:0:0.3"/>
        </Transitions>
      </Setter>
      <Setter Property="BorderThickness" Value="1.5"/>
      <Setter Property="BorderBrush" Value="#2A8FD7"/>
    </Style>

    <Style Selector="Border.postCard:pointerover">
      <Setter Property="Opacity" Value="0.9"/>
    </Style>

    <Style Selector="Border.postCard.selected">
      <Setter Property="BorderBrush" Value="#FFD700"/>
      <Setter Property="BorderThickness" Value="3"/>
    </Style>
  </Window.Styles>

  <Grid ColumnDefinitions="320,*" Margin="12">
    <Border Grid.Column="0" Background="#1A2330" CornerRadius="10" Padding="14">
      <ScrollViewer VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Disabled">
      <StackPanel Spacing="8" Margin="0,0,4,0">

        <Expander IsExpanded="True" Header="Search">
          <StackPanel Spacing="6" Margin="0,8,0,0">
            <TextBlock Text="Booru" FontSize="12" Foreground="#8FB0CF"/>
            <ComboBox ItemsSource="{Binding Sites}" SelectedItem="{Binding SelectedSite}"/>

            <TextBlock Text="Tags" FontSize="12" Foreground="#8FB0CF" Margin="0,4,0,0"/>
            <TextBox Watermark="e.g. blue_eyes solo" Text="{Binding SearchText}" KeyDown="SearchTextBox_OnKeyDown"/>

            <TextBlock Text="Recent" FontSize="12" Foreground="#8FB0CF" Margin="0,4,0,0"/>
            <Grid ColumnDefinitions="*,Auto">
              <ComboBox Grid.Column="0" ItemsSource="{Binding RecentSearches}" SelectedItem="{Binding SelectedRecentSearch}"/>
              <Button Grid.Column="1" Content="X" Width="28" Margin="4,0,0,0" Command="{Binding ClearHistoryCommand}" ToolTip.Tip="Clear history"/>
            </Grid>

            <Button Content="Search" Command="{Binding SearchCommand}" Height="32" Margin="0,8,0,0"/>
          </StackPanel>
        </Expander>

        <Expander IsExpanded="True" Header="Results">
          <StackPanel Spacing="6" Margin="0,8,0,0">
            <Grid ColumnDefinitions="*,*">
              <StackPanel Grid.Column="0" Spacing="2">
                <TextBlock Text="Per page" FontSize="12" Foreground="#8FB0CF"/>
                <ComboBox ItemsSource="{Binding PageSizeOptions}" SelectedItem="{Binding SelectedPageSize}"/>
              </StackPanel>
              <StackPanel Grid.Column="1" Spacing="2" Margin="4,0,0,0">
                <TextBlock Text="Sort" FontSize="12" Foreground="#8FB0CF"/>
                <ComboBox ItemsSource="{Binding SortOptions}" SelectedItem="{Binding SelectedSortOption}"/>
              </StackPanel>
            </Grid>

            <TextBlock Text="Media type" FontSize="12" Foreground="#8FB0CF" Margin="0,4,0,0"/>
            <ComboBox ItemsSource="{Binding MediaTypeFilterOptions}" SelectedItem="{Binding SelectedMediaTypeFilter}"/>

            <TextBlock Text="Size" FontSize="12" Foreground="#8FB0CF" Margin="0,4,0,0"/>
            <ComboBox ItemsSource="{Binding SizeFilterOptions}" SelectedItem="{Binding SelectedSizeFilter}"/>

            <StackPanel Orientation="Horizontal" Spacing="8" IsVisible="{Binding ShowRatingFilters}" Margin="0,4,0,0">
              <CheckBox Content="Safe" IsChecked="{Binding IncludeSafe}"/>
              <CheckBox Content="Quest." IsChecked="{Binding IncludeQuestionable}"/>
              <CheckBox Content="Adult" IsChecked="{Binding IncludeAdult}"/>
            </StackPanel>

            <CheckBox Content="{Binding FavoritesSummary}" IsChecked="{Binding ShowFavoritesOnly}" Margin="0,4,0,0"/>
          </StackPanel>
        </Expander>

        <Expander IsExpanded="True" Header="Filters">
          <StackPanel Spacing="6" Margin="0,8,0,0">
            <Grid ColumnDefinitions="*,*,*">
              <StackPanel Grid.Column="0" Spacing="2">
                <TextBlock Text="Min score" FontSize="12" Foreground="#8FB0CF"/>
                <ComboBox ItemsSource="{Binding MinimumScoreOptions}" SelectedItem="{Binding MinimumScore}"/>
              </StackPanel>
              <StackPanel Grid.Column="1" Spacing="2" Margin="4,0,0,0">
                <TextBlock Text="Min width" FontSize="12" Foreground="#8FB0CF"/>
                <ComboBox ItemsSource="{Binding MinimumDimensionOptions}" SelectedItem="{Binding MinimumWidth}"/>
              </StackPanel>
              <StackPanel Grid.Column="2" Spacing="2" Margin="4,0,0,0">
                <TextBlock Text="Min height" FontSize="12" Foreground="#8FB0CF"/>
                <ComboBox ItemsSource="{Binding MinimumDimensionOptions}" SelectedItem="{Binding MinimumHeight}"/>
              </StackPanel>
            </Grid>

            <TextBlock Text="Must include" FontSize="12" Foreground="#8FB0CF" Margin="0,4,0,0"/>
            <TextBox Watermark="tag_a tag_b" Text="{Binding RequiredTags}"/>

            <TextBlock Text="Exclude" FontSize="12" Foreground="#8FB0CF" Margin="0,4,0,0"/>
            <TextBox Watermark="tag_x tag_y" Text="{Binding ExcludedTags}"/>

            <Button Content="Reset filters" Command="{Binding ResetLocalFiltersCommand}" Margin="0,4,0,0"/>
          </StackPanel>
        </Expander>

        <StackPanel Orientation="Horizontal" Spacing="8">
          <Button Content="Shuffle" Command="{Binding ShuffleVisibleCommand}" Padding="12,6"/>
          <Button Content="Export CSV" Command="{Binding ExportVisibleCommand}" Padding="12,6"/>
        </StackPanel>

        <Separator Margin="0,4,0,4"/>

        <Expander Header="Account">
          <StackPanel Spacing="6" Margin="0,8,0,0">
            <TextBlock Text="{Binding LoggedInAsText}" IsVisible="{Binding ShowLoggedInInfo}" Foreground="#59BEF9"/>

            <StackPanel Spacing="4" IsVisible="{Binding ShowCredentialInputs}">
              <TextBlock Text="Username" FontSize="12" Foreground="#8FB0CF"/>
              <TextBox Text="{Binding Username}"/>

              <TextBlock Text="{Binding SecretLabel}" FontSize="12" Foreground="#8FB0CF" Margin="0,4,0,0"/>
              <TextBox Text="{Binding Secret}" PasswordChar="*"/>
            </StackPanel>

            <Button Content="{Binding LoginButtonText}" Command="{Binding LoginToggleCommand}" Margin="0,4,0,0"/>
          </StackPanel>
        </Expander>

        <Button Content="Check for updates" Click="CheckUpdatesButton_OnClick" HorizontalAlignment="Left" Padding="12,6"/>

      </StackPanel>
      </ScrollViewer>
    </Border>

    <Grid Grid.Column="1" RowDefinitions="*,Auto" Margin="12,0,0,0">
      <Border Grid.Row="0" Background="#0F141B" CornerRadius="10" Padding="10">
        <TabControl>
          <TabItem Header="Browse">
            <ScrollViewer x:Name="PostsScrollViewer"
                          ScrollChanged="PostsScrollViewer_OnScrollChanged"
                          VerticalScrollBarVisibility="Visible"
                          HorizontalScrollBarVisibility="Disabled"
                          AllowAutoHide="False">
              <ItemsControl ItemsSource="{Binding Images}" ItemTemplate="{StaticResource PostCardTemplate}">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal" ItemWidth="368" ItemHeight="424"/>
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
              </ItemsControl>
            </ScrollViewer>
          </TabItem>

          <TabItem Header="{Binding FavoritesTabTitle}">
            <ScrollViewer VerticalScrollBarVisibility="Visible"
                          HorizontalScrollBarVisibility="Disabled"
                          AllowAutoHide="False">
              <ItemsControl ItemsSource="{Binding FavoriteImages}" ItemTemplate="{StaticResource PostCardTemplate}">
                <ItemsControl.ItemsPanel>
                  <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal" ItemWidth="368" ItemHeight="424"/>
                  </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
              </ItemsControl>
            </ScrollViewer>
          </TabItem>
        </TabControl>
      </Border>

      <Border Grid.Row="1" Margin="0,10,0,0" Background="#1A2330" CornerRadius="8" Padding="10,6">
        <TextBlock Text="{Binding StatusText}"/>
      </Border>
    </Grid>
  </Grid>
</Window>
